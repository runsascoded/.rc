#!/usr/bin/env bash

uname -a | grep -q "raspberrypi" > /dev/null
if [ $? -eq 0 ]; then
    export RPI=1
    echo "Sourcing .rpi_bashrc.."

    export NODE_JS_HOME=/home/$USER/node-v0.10.2-linux-arm-pi 
    export PATH=$HOME/bin:$PATH:$NODE_JS_HOME/bin:/opt/mongo/bin:/opt/meteor
    export MONGO_URL=mongodb://127.0.0.1:27017/test
fi

#sudo apt-get install python-dateutil

rpzs() {
	for i in `seq 5`; do
		echo rpz$i
	done
}
rpis() {
	rpzs
	echo rpi rpi2 | spc
}

smap() {
	cat | p "echo {}; ssh {} \"$@\"; echo ''"
}

rpzmap() {
	rpzs | smap "$@"
}

rpmap() {
	rpis | smap "$@"
}

update_temps() {
	if [ $# -eq 0 ]; then
		args="$(rpis)"
	else
		args="$@"
	fi
	if [ ! -e read.py ]; then
		echo "Couldn't find read.py; run from sensors git clone" 1>&2
		return 1
	fi
	echo "$args" | spc | p 'scp read.py {}: && ssh {} "sudo service temps restart" && echo {}'
}
