#!/bin/bash

export_assign() {
  key="$1"
  val="$2"
  eval "export $key=$val"
}

append_to() {
  var="$1"
  shift
  for arg in "$@"; do
    if [ -d "$arg" ]; then
      export_assign "$var" "$(eval "echo \$$var"):$arg"
    else
      debug "Not appending '$arg' to '\$$var'; '$arg' not a directory"
    fi
  done
}

prepend_to() {
  var="$1"
  shift
  for arg in "$@"; do
    if [ -d "$arg" ]; then
      export_assign "$var" "$arg:$(eval "echo \$$var")"
    else
      debug "Not prepending '$arg' to '\$$var'; '$arg' not a directory"
    fi
  done
}

prepend_to_path() {
  prepend_to PATH "$@"
}

append_to_path() {
  append_to PATH "$@"
}


dedupe_path_var() {
  for var in "$@"; do
    var_contents="$(eval "echo \"\$$var\"")"

    # Dedupe variable `var`, e.g. on re-source-ing this .bashrc.
    path_segments=$(echo "$var_contents" | splt :)
    num_path_segments=$(echo "$path_segments" | wc -l | tr -d ' ')

    sorted_unique_path_segments=$(echo "$var_contents" | splt : | sort | uniq)
    num_unique_num_path_segments=$(echo "$sorted_unique_path_segments" | wc -l | tr -d ' ')

    if [ $num_path_segments -ne $num_unique_num_path_segments ]; then

      debug "Deduping \$$var variable from $num_path_segments segments down to $num_unique_num_path_segments..."

      debug "Before \$$var: $var_contents"
      export_assign "$var" "$(echo $path_segments | dedupe | joyn :)"
      debug "After \$$var: $(eval "echo \"\$$var\"")"
    fi
  done
}
