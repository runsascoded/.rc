#!/usr/bin/env bash

alias edp=explode-parent-dirs

rsync-only() {
  arg="$1"
  shift
  rsync -avzh --include="$arg" --exclude='*' "$@"
}
defn rso rsync-only

rsync-only-n() {
  arg="$1"
  shift
  rsync-only "$arg" -n "$@"
}
defn rson rsync-only-n

rsync-paths() {
  args=()
  flags=()

  from="${@:(($#-1)):1}"
  to="${@:$#}"

  for arg in "${@:1:(($# - 2))}"; do
    if [ "${arg::1}" != '-' ]; then

      for path in $(dir-tree "$arg"); do
        args+=("--include=$path")
      done

      args+=("--include=$arg/**")
    else
      flags+=("$arg")
    fi

  done
  echo rsync -avzh "${flags[@]}" "${args[@]}" --exclude='*' "$from" "$to"
  rsync -avzh "${flags[@]}" "${args[@]}" --exclude='*' "$from" "$to"
}
defn rsp rsync-paths
defn rsn rsync-paths -n
defn rspr rsync-paths --remove-source-files

defn epd explode-parent-dirs

alias rsc="rsync -avzh"
alias rsr="rsync -avzh --remove-source-files"
alias rsrc="rsync -avzh --remove-source-files"
alias rscn="rsync -avzhn"
